---
# date: "2022-05-02T00:00:00Z"
# external_link: ""
# image:
#   caption: Dylla et al., 2023
#   focal_point: Smart
# links:
# - icon: ""
#   icon_pack: fab
#   name: Preprint
#   url: https://www.biorxiv.org/content/10.1101/2023.01.08.523155v1.full.pdf
# # slides: example
# summary: Analysis of projection neuron terminals odor responses in fruit flies, investigating the influence of prior odor experience on neural coding.
# tags:
# - Calcium Imaging
# - Data Analysis
# - MATLAB
# - R
# title: "Data Analysis: Odor Responses in Projection Neuron Terminals"
# url_code: ""
# url_pdf: ""
# url_slides: ""
# url_video: ""
# share: false
# 
# 
# <span style="color:blue">**Motivation:** For my most recent study at Caltech [(preprint)](https://www.biorxiv.org/content/10.1101/2023.01.08.523155v1), I collected 2-photon calcium imaging data from projection neuron (PN) terminals in fruit flies. I was interested in the effects of early life odor exposure on the neuronal representations of odors in the brain and therefore gathered the data from two groups of flies: one group had previously been exposed to banana odor while the other group had not been exposed to an odor (control). The following analysis of the acquired data focuses on comparing the responses of PNs between the two groups.</span>
# 
# <u>**1. Data preprocessing:**</u>  
# 
# **Data quality assessment:**  The dataset was checked for incomplete recordings, strong motion artifacts, poor signal quality, and unresponsive flies.
# {{< figure library="true" src="PN-list.jpg" width="90%" lightbox="false" >}}
# 
# **Data cleaning:**  Recordings not meeting the quality standard were excluded from further analysis.  
# 
# **Motion correction:** Movies of raw fluorescence comprising the three trials for each odor stimulus were motion-corrected (rigid) in MATLAB, and a mean projection of each movie was created.  
# 
# **Image registration:** For each fly, the mean projection for one movie (one stimulus) was selected as a template, and the remaining mean projections were aligned to the template using rigid image registration. The vector for image alignment was then applied back onto the whole movies to achieve image registration across all movies of a fly.
# 
# <span style="color:blue">*The movie below shows a motion-corrected, registered recording of PN terminals responding to three pulses of banana odor. Speed: 10x.*</span>
# 
# {{< video library="true" src="20210319 a 18 Image 0001 0001 rigid shifted 50fps.mp4" controls="yes">}}
# 
# <u>**2. Region of interest (ROI) selection:**</u> 
# 
# **Manual ROI selection:** A total average image across all mean projections was computed and was used for manual creation of a ROI in each fly, which circumscribed all labeled PN terminals in that imaging plane as defined by the fluorescence of the calcium indicator.
# {{< figure library="true" src="PN-singleROI.jpg" width="50%" title="Example: fluorescence in PN terminals with the yellow line marking the selected ROI." lightbox="false" >}}
# 
# **Semi-automated ROI extraction:** The Python image processing pipeline Suite2P was used to identify and extract ROIs where clusters of PN terminals showed similar response dynamics to odor stimulation.
# {{< figure library="true" src="PN-Suite2P.png" width="90%" title="Example of ROIs identified with the help of Suite2P." lightbox="false" >}}
# 
# <u>**3. Baseline correction:**</u> 
# 
# ΔF/F videos were created by computing the relative change in fluorescence (ΔF) normalized to the mean fluorescence (F) in the baseline epoch (first 40 frames or ~8.9 s of the pre-stimulus baseline period), in each pixel of each frame.
# 
# <u>**4. Signal extraction:**</u> 
# 
# Change in fluorescence over time in each ROI was determined by computing the mean ΔF/F value across pixels inside the ROI for each frame of the movie, averaged across trials. 
# 
# <u>**5. Data visualization:**</u>
# 
# <span style="color:blue">*After the initial processing steps, visualizing the processed data helped me validate its accuracy and quality, and it guided me in the subsequent analysis.*</span>
# 
# **Heatmaps:** A seven-frame window starting at the time of nominal stimulus onset was defined. The frame with the maximum ΔF/F in the ROI was designated the peak response for that trial. Where applicable, heatmaps of peak responses were generated by averaging across the three trials of the stimulus.
# {{< figure library="true" src="PN-heatmaps.jpg" width="90%" title="Peak ΔF/F odor-evoked response patterns in PN terminals in an example imaging plane. Grayscale image (left) shows raw fluorescence. Images (right) are trial-averaged peak responses (three trials/stimulus) to the odors of empty vial, banana, wine, or 2-butanone, each diluted 10-4 in water. Scale bar, 10 µm. Dylla et al., 2023." lightbox="false" >}}
# 
# **Trace plots:** The average change in fluorescence over time was calculated across flies for each odor exposure group. An error envelope representing the 95% CI was added.
# 
# {{< figure library="true" src="PN-traces.jpg" width="70%" title="Change in fluorescence over time (mean and 95% CI) in PN terminals in response to increasing concentrations of banana odor, wine odor, or 2-butanone odor in banana odor- (red) and control- (gray) exposed flies. Blue bar indicates time of 1-s odor pulse. Dylla et al., 2023." lightbox="false" >}} 
# 
# <u>**6. Sanity check**</u>
# 
# <span style="color:blue">*It is known that odor-evoked response patterns in PN terminals are odor-specific. To demonstrate that this is also the case in my dataset, and hence confirm its quality, I used analysis methods for visualizing and measuring similarity/dissimilarity. Above heatmaps of peak ΔF/F odor-evoked response patterns already suggested that the neuronal activity patterns elicited by the odors of banana, wine, and 2-butanone differ. The differences between two PN activity patterns can be even better seen with image subtraction.*</span>
# 
# **Image subtraction:** A delta image made by subtracting the pixel values of the peak response image of one odor from the peak response image of another odor at the same odor concentration.
# {{< figure library="true" src="PN-deltaimages.jpg" width="90%" title="Difference between peak ΔF/F response patterns in PN terminals to banana and wine odors at increasing stimulus intensities in a control-exposed fly. Red designates pixels activated more by banana odor than wine odor; blue designates the reverse. Dylla et al., 2023." lightbox="false" >}} 
# 
# <span style="color:blue">*Besides that, I expected activity patterns elicited by repeated presentations of the same odor to be similar. An efficient way to compare the peak response patterns of an individual fly is to compute a Pearson correlation matrix.*</span>
# 
# **Pearson correlations:** Within a fly, pixel-by-pixel Pearson correlations were performed pairwise on peak response frames of individual odor pulses. 
# {{< figure library="true" src="PN-correlation.jpg" width="50%" title="Pairwise Pearson correlation across pixels of peak PN response patterns evoked by different odor stimuli. Each small block is the similarity between the response patterns elicited in individual trials of the indicated stimuls. Dylla et al., 2023." lightbox="false" >}} 
# 
# <span style="color:blue">*The spatial patterns of peak odor-evoked responses across PN terminals were reliable and odor-specific: patterns of PN terminals activity from trials of the same odor were highly correlated to one another compared with PN activity from trials presenting different odors.* </span>
# 
# <span style="color:blue">*Next, I used principal component analysis to test whether the PN activity reliably encodes odor identity over a range of odor concentrations (see trace plot above).* </span>
# 
# **Principal component analysis (PCA):** Inputs to PCA were the 57 peak response patterns recorded in an individual fly to 19 different odor stimuli. Images were smoothed with a 2D Gaussian kernel with standard diviation of 2 prior to PCA. Inputs were centered but not scaled. Pixels outside the ROI were assigned a value of zero.
# {{< figure library="true" src="PN-PCA.jpg" width="90%" title="Principal component analysis of odor-evoked response patterns in PN terminals across all stimuli in the concentration series for banana, wine, and 2-butanone. Numbers in parentheses indicate the percentage of the variance in the data accounted for by each principal component. Dylla et al., 2023." lightbox="false" >}}
# 
# <span style="color:blue">*Principal component analysis on the spatial patterns of PN activity elicited across all stimuli in all three odor concentration series (in an individual fly) showed that, whereas the first principal component (PC) captured mostly variation from stimulus intensity, as expected, PN response patterns elicited by the three odors were well separated by their weightings on PC2 and PC3. The separability of PN representations of different odors increased with stimulus intensity. Thus, odor-evoked activity in PN terminals reliably encodes stimulus identity.*</span>
# 
# <u>**7. Quantification and statistical analysis**</u>
# 
# **Dose response curves:** The response curves of peak ΔF/F as a function of stimulus concentration were fit to a three-parameter logistic function: PN response=R_max/(1+10^((-s*(x-logEC50)))).
# {{< figure library="true" src="PN-concentrationcurves.jpg" width="30%" title="Dose-response curves plotting peak PN response amplitudes (mean and 95% CI) at each concentration of each odor. Dylla et al., 2023." lightbox="false">}}
# 
# <span style="color:blue">*The mean peak PN response amplitude (computed in an ROI circumscribing all PN terminals in the imaging plane for each fly) increased with concentration for all odors. Comparing PN response amplitudes in banana odor-exposed flies and control flies, I observed no significant differences in PN sensitivity to any odors, including to the familiar odor banana.*</span>
# 
# <span style="color:blue">*While there was no difference in the PN response amplitudes to odors, I could not exclude more subtle chances in the PN activity patterns, caused by prior exposure to banana odor. For example, does prior exposure lead to a more distinct neuronal representation of banana odor, decreasing its similarity to other odors? To compare the similarity of odor representations across the two experimental groups, I computed Pearson correlation matrices for each exposure group and odor concentration.*</span>
# 
# **Pearson correlation matrices:** Pixel-by-pixel Pearson correlations were performed pairwise on peak response frames of individual odor pulses. The Pearson's correlation coefficient was averaged over trials (self-correlations were excluded). Correlation matrices were averaged over flies.
# {{< figure library="true" src="PN-correlationmatrices.jpg" width="90%" title="Mean pairwise Pearson correlation of peak PN response patterns evoked by an empty odor vial, the solvent water, and different odors (banana, wine, and 2-butanone), at three different stimulus intensities (10-3, 10-4, and 10-5 from left to right), in banana odor- and control-exposed flies. Odor relationships, as measured by correlation in PN activity, are not significantly different between banana odor- and control-exposed flies for any pair of odors at any concentration (p ≥ 0.05, two-tailed permutation test for difference in means). Dylla et al., 2023." lightbox="false">}}
# 
# <span style="color:blue">*Chronic exposure to banana odor did not significantly affect the relationship between any odors, including banana odor, in the representational space defined by PN terminals responses.*</span>
# 
# **Permutation testing:** Two-way statistical comparisons were performed using permutation testing; the null hypothesis was that all samples from the two comparison groups belong to the same distribution. Observations across experiments for the two conditions being compared were combined and randomly reassigned (permuted) into two groups, maintaining the number of observations in each comparison group. The difference between the means of the shuffled groups was calculated. The permutation process was repeated for a total of 10,000 resamplings, and the two-tailed p-value for the comparison was computed as the proportion of resamplings in which the absolute difference of the resampled means was larger than the absolute value of the observed difference between experimental groups. Statistical significance reported reflect Bonferroni-adjustment of p-values to correct for multiple comparisons in a given analysis.
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# <span style="color:blue">*Does this second negative result conclusively exclude the possibility of prior odor exposure changing PN responses to the familiar odor? It doesn't. I also had to investigate the dynamics of PN activity in response to odor stimuli of varying temporal structure. To this end, I collected a second dataset in which flies were presented banana odor with three different temporal structures.*</span>
# 
# {{< figure library="true" src="PN-odorpulses.jpg" width="90%" title="Change in fluorescence over time (mean and 95% CI) in PN axon terminals of banana odor- (red) and control- (gray) exposed flies in response to banana odor presented with three different temporal structures (stimulus timing indicated by blue bars). To allow direct comparisons of response dynamics, bulk ΔF/F signals were normalized to the peak amplitude in every trial. Odor stimuli comprised of 10 seconds of undiluted banana odor presented as a 0.1 Hz train at 10% duty cycle (intermittent); a 0.5 Hz train at 50% duty cycle (fluctuating); or a sustained 10-s pulse (continuous). Dylla et al., 2023." lightbox="false">}}
# 
# 
# Statistical Analysis:
# Comparisons: Perform statistical tests to compare responses between different conditions or groups.
# Correlation Analysis: Explore relationships between different neurons or conditions.
# Population Analysis: Analyze responses at the population level.
# 
# Machine Learning Approaches:
# Classification: Train models to classify neuronal responses based on specific features.
# Dimensionality Reduction: Use techniques like principal component analysis (PCA) for reducing data complexity.
# 
# Integration with Behavioral Data:
# Alignment: Synchronize calcium imaging data with behavioral events or stimuli.
# Correlation with Behavior: Investigate how neural activity correlates with specific behaviors.
# 
# Data Interpretation and Reporting:
# Drawing Conclusions: Interpret the findings in the context of the research question.
# Visualization for Publication: Prepare figures and graphs for publication.

---
